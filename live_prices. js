const coinIds = {
  usdt: "tether",
  btc: "bitcoin",
  bnb: "binancecoin",
  bonk: "bonk"
};

async function updateFundingPrices() {
  try {
    const ids = Object.values(coinIds).join(",");
    const res = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=usd`);
    const data = await res.json();

    const rows = document.querySelectorAll(".asset-row");
    rows.forEach(row => {
      const nameEl = row.querySelector(".asset-name");
      const symbol = nameEl?.getAttribute("data-symbol");
      const id = coinIds[symbol?.toLowerCase()];
      if (!symbol || !id || !data[id]) return;

      const qtyText = row.querySelector(".asset-amount")?.textContent || "0";
      const qty = parseFloat(qtyText.replace(/,/g, ""));
      if (isNaN(qty)) return;

      const usdPrice = data[id].usd;
      const totalUsd = qty * usdPrice;

      const usdDiv = row.querySelector(".asset-usd");
      if (usdDiv) {
        usdDiv.textContent = `$${totalUsd.toLocaleString(undefined, {
          minimumFractionDigits: 2,
          maximumFractionDigits: 2
        })}`;
      }
    });
  } catch (e) {
    console.error("Price fetch failed", e);
  }
}

window.addEventListener("load", () => {
  updateFundingPrices();
  setInterval(updateFundingPrices, 15000);
});
