const coinMap = {
  btc: "bitcoin",
  bnb: "binancecoin",
  eth: "ethereum",
  bonk: "bonk",
  usdt: "tether"
};

async function fetchPrices() {
  const ids = Object.values(coinMap).join(",");
  const res = await fetch(
    `https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=usd`
  );
  const data = await res.json();
  return data;
}

function formatUSD(amount) {
  if (amount < 1) {
    return `$${amount.toFixed(8)}`;
  }
  return `$${amount.toLocaleString(undefined, {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  })}`;
}

async function updateAssetPrices() {
  const prices = await fetchPrices();

  document.querySelectorAll(".asset-row").forEach(row => {
    const nameEl = row.querySelector(".asset-name");
    const usdEl = row.querySelector(".asset-usd");
    const amountEl = row.querySelector(".asset-amount");

    if (!nameEl || !usdEl || !amountEl) return;

    const symbol = nameEl.textContent.trim().toLowerCase();
    const priceInfo = prices[coinMap[symbol]];
    if (!priceInfo) return;

    const tokenQty = parseFloat(amountEl.textContent.replace(/,/g, ""));
    const usdValue = tokenQty * priceInfo.usd;
    usdEl.textContent = formatUSD(usdValue);
  });
}

window.addEventListener("load", () => {
  updateAssetPrices();
  setInterval(updateAssetPrices, 15000); // every 15s
});
